<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Mind Reader</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --primary-light: #818cf8;
            --primary-dark: #4f46e5;
            --secondary: #f59e0b;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            
            --border-radius: 0.75rem;
            --border-radius-sm: 0.5rem;
            --border-radius-lg: 1rem;
            --border-radius-xl: 1.5rem;
            
            --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--gray-900);
            line-height: 1.6;
            min-height: 100vh;
        }

        .app {
            min-height: 100vh;
            padding: 2rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 3rem;
            color: white;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #ffffff 0%, #f0f9ff 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .header p {
            font-size: 1.25rem;
            opacity: 0.9;
            font-weight: 300;
        }

        /* Input Section */
        .input-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius-xl);
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-xl);
        }

        .input-group {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .text-input {
            flex: 1;
            min-width: 300px;
            padding: 1rem 1.5rem;
            border: 2px solid var(--gray-200);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
            background: white;
            font-family: inherit;
        }

        .text-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }

        .button-group {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            font-family: inherit;
            white-space: nowrap;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: var(--shadow);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: white;
            color: var(--gray-700);
            border: 2px solid var(--gray-200);
        }

        .btn-secondary:hover {
            background: var(--gray-50);
            border-color: var(--gray-300);
            transform: translateY(-1px);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        /* Help Section */
        .help-section {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border: 1px solid #bfdbfe;
            border-radius: var(--border-radius-xl);
            padding: 2rem;
            margin-bottom: 2rem;
            animation: fadeInDown 0.5s ease;
        }

        .help-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 1.5rem;
        }

        .help-card {
            background: white;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
        }

        .help-card h4 {
            color: var(--primary);
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .help-card ul {
            list-style: none;
            padding-left: 0;
        }

        .help-card li {
            padding: 0.25rem 0;
            padding-left: 1.5rem;
            position: relative;
        }

        .help-card li::before {
            content: "•";
            color: var(--primary);
            font-weight: bold;
            position: absolute;
            left: 0;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 3rem;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius-xl);
            margin-bottom: 2rem;
            animation: pulse 2s infinite;
        }

        .spinner {
            width: 2.5rem;
            height: 2.5rem;
            border: 3px solid var(--gray-200);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        /* Results Grid */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 2rem;
        }

        /* Cards */
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius-xl);
            padding: 2rem;
            box-shadow: var(--shadow-xl);
            transition: var(--transition);
            animation: fadeInUp 0.6s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--gray-900);
        }

        .card-icon {
            width: 2rem;
            height: 2rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            border-radius: var(--border-radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .info-box {
            background: linear-gradient(135deg, var(--gray-50) 0%, #f8fafc 100%);
            border: 1px solid var(--gray-200);
            border-radius: var(--border-radius);
            padding: 1rem;
            margin-bottom: 1.5rem;
            font-size: 0.875rem;
        }

        .info-box strong {
            color: var(--primary);
        }

        /* Token Visualizations */
        .tokens-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin: 1.5rem 0;
        }

        .token {
            padding: 0.5rem 0.75rem;
            border-radius: var(--border-radius-sm);
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
            position: relative;
            background: var(--gray-100);
            color: var(--gray-700);
        }

        .token:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary);
        }

        .layer-selector {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .layer-btn {
            padding: 0.5rem 1rem;
            border: 2px solid var(--gray-200);
            background: white;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            font-size: 0.875rem;
        }

        .layer-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            box-shadow: var(--shadow);
        }

        .layer-btn:hover:not(.active) {
            background: var(--gray-50);
            border-color: var(--gray-300);
        }

        /* Neurons */
        .neuron-list {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 1rem;
        }

        .neuron-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            margin-bottom: 0.75rem;
            background: linear-gradient(135deg, var(--gray-50) 0%, white 100%);
            border: 1px solid var(--gray-200);
            border-radius: var(--border-radius);
            transition: var(--transition);
            cursor: pointer;
        }

        .neuron-item:hover {
            background: linear-gradient(135deg, #eff6ff 0%, white 100%);
            border-color: var(--primary);
            transform: translateX(4px);
        }

        .neuron-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .neuron-id {
            font-weight: 600;
            color: var(--gray-900);
        }

        .neuron-type {
            font-size: 0.75rem;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .activation-value {
            font-family: 'Monaco', 'Menlo', monospace;
            font-weight: 600;
            color: var(--primary);
            background: rgba(99, 102, 241, 0.1);
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
        }

        /* Attention Matrix */
        .attention-container {
            overflow-x: auto;
            margin-top: 1rem;
            border-radius: var(--border-radius);
            background: white;
            padding: 1rem;
            border: 1px solid var(--gray-200);
        }

        .attention-cell {
            transition: var(--transition);
            cursor: pointer;
        }

        .attention-cell:hover {
            stroke: var(--primary);
            stroke-width: 2px;
        }

        /* Features */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .feature-item {
            background: linear-gradient(135deg, var(--gray-50) 0%, white 100%);
            border: 1px solid var(--gray-200);
            border-radius: var(--border-radius);
            padding: 1rem;
            text-align: center;
            transition: var(--transition);
        }

        .feature-item:hover {
            background: linear-gradient(135deg, #eff6ff 0%, white 100%);
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .feature-count {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.25rem;
        }

        .feature-label {
            font-size: 0.875rem;
            color: var(--gray-600);
            font-weight: 500;
        }

        /* Status Indicator */
        .status {
            position: fixed;
            top: 2rem;
            right: 2rem;
            padding: 0.75rem 1rem;
            border-radius: var(--border-radius);
            font-size: 0.875rem;
            font-weight: 600;
            z-index: 1000;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: var(--shadow-lg);
            animation: slideInRight 0.5s ease;
        }

        .status.success {
            background: rgba(16, 185, 129, 0.9);
            color: white;
        }

        .status.demo {
            background: rgba(59, 130, 246, 0.9);
            color: white;
        }

        .status.error {
            background: rgba(239, 68, 68, 0.9);
            color: white;
        }

        /* Comparison Section */
        .comparison-section {
            margin-top: 2rem;
            padding: 2rem;
            background: linear-gradient(135deg, #f8fafc 0%, white 100%);
            border: 1px solid var(--gray-200);
            border-radius: var(--border-radius-xl);
        }

        .analysis-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 2rem;
        }

        .search-input {
            flex: 1;
            min-width: 250px;
            padding: 0.75rem 1rem;
            border: 2px solid var(--gray-200);
            border-radius: var(--border-radius);
            font-size: 0.875rem;
            transition: var(--transition);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        /* Analysis Results */
        .analysis-result {
            margin-bottom: 2rem;
            border: 2px solid var(--gray-200);
            border-radius: var(--border-radius-xl);
            overflow: hidden;
            background: white;
            box-shadow: var(--shadow-sm);
        }

        .result-header {
            background: linear-gradient(135deg, var(--gray-50) 0%, white 100%);
            padding: 1.5rem;
            border-bottom: 1px solid var(--gray-200);
        }

        .result-content {
            padding: 1.5rem;
        }

        .activation-bar {
            display: flex;
            align-items: center;
            margin: 0.75rem 0;
            font-size: 0.875rem;
        }

        .bar-label {
            width: 80px;
            font-weight: 600;
            color: var(--gray-700);
        }

        .bar-visual {
            height: 24px;
            border-radius: 0.375rem;
            margin-right: 1rem;
            position: relative;
            overflow: hidden;
            background: var(--gray-100);
        }

        .bar-fill {
            height: 100%;
            border-radius: 0.375rem;
            transition: var(--transition);
        }

        .bar-value {
            font-family: 'Monaco', 'Menlo', monospace;
            font-weight: 600;
            color: var(--gray-600);
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .app {
                padding: 1rem;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .header p {
                font-size: 1rem;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            .input-group {
                flex-direction: column;
            }
            
            .text-input {
                min-width: 100%;
            }
            
            .button-group {
                width: 100%;
                justify-content: center;
            }
            
            .analysis-controls {
                flex-direction: column;
            }
            
            .search-input {
                min-width: 100%;
            }
        }

        /* Tooltip */
        .tooltip {
            position: absolute;
            background: var(--gray-900);
            color: white;
            padding: 0.5rem 0.75rem;
            border-radius: var(--border-radius-sm);
            font-size: 0.75rem;
            pointer-events: none;
            z-index: 1000;
            opacity: 0;
            transition: var(--transition);
            box-shadow: var(--shadow-lg);
            backdrop-filter: blur(10px);
        }

        .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -4px;
            border-width: 4px;
            border-style: solid;
            border-color: var(--gray-900) transparent transparent transparent;
        }

        /* Beautiful scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--gray-100);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gray-300);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--gray-400);
        }
    </style>
</head>
<body>
    <div class="app">
        <div class="container">
            <!-- Header -->
            <div class="header">
                <h1>🧠 AI Mind Reader</h1>
                <p>Explore how artificial intelligence processes language, word by word, thought by thought</p>
            </div>

            <!-- Input Section -->
            <div class="input-section">
                <div class="input-group">
                    <input type="text" id="textInput" class="text-input" 
                           placeholder="Enter any text to peek inside the AI's mind..." 
                           value="The curious cat explored the mysterious garden">
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="analyze()">
                            🔍 Analyze Mind
                        </button>
                        <button class="btn btn-secondary" onclick="loadExample('sentiment')">
                            😊 Emotions
                        </button>
                        <button class="btn btn-secondary" onclick="loadExample('grammar')">
                            📝 Grammar
                        </button>
                        <button class="btn btn-success" onclick="showHelp()">
                            ❓ How it Works
                        </button>
                    </div>
                </div>
            </div>

            <!-- Help Section -->
            <div id="helpSection" class="help-section" style="display: none;">
                <div style="text-align: center; margin-bottom: 2rem;">
                    <h3 style="color: var(--primary); font-size: 1.5rem; font-weight: 600; margin-bottom: 0.5rem;">
                        🎯 Understanding AI Thoughts
                    </h3>
                    <p style="color: var(--gray-600); font-size: 1rem;">
                        This dashboard reveals the hidden thought processes of artificial intelligence
                    </p>
                </div>
                
                <div class="help-grid">
                    <div class="help-card">
                        <h4>🎨 Neural Activity Colors</h4>
                        <p style="margin-bottom: 1rem; color: var(--gray-600);">Think of this like a brain scan for AI. Colors show how much attention the AI pays to each word:</p>
                        <ul>
                            <li><strong style="color: #3b82f6;">Blue tones:</strong> Low attention - AI barely notices</li>
                            <li><strong style="color: #f59e0b;">Yellow tones:</strong> Moderate attention - some interest</li>
                            <li><strong style="color: #ef4444;">Red tones:</strong> High attention - AI is very focused</li>
                        </ul>
                    </div>
                    
                    <div class="help-card">
                        <h4>🏗️ Processing Layers</h4>
                        <p style="margin-bottom: 1rem; color: var(--gray-600);">AI thinks in stages, like how humans process language:</p>
                        <ul>
                            <li><strong>Layer 0-1:</strong> "What letters and sounds do I see?"</li>
                            <li><strong>Layer 2-3:</strong> "What type of word is this?" (noun, verb, etc.)</li>
                            <li><strong>Layer 4-5:</strong> "What does this mean in context?"</li>
                        </ul>
                    </div>
                    
                    <div class="help-card">
                        <h4>🔬 Why This Matters</h4>
                        <p style="color: var(--gray-600);">This technology helps us:</p>
                        <ul>
                            <li><strong>Build trust:</strong> See exactly how AI makes decisions</li>
                            <li><strong>Improve safety:</strong> Catch potential biases or errors</li>
                            <li><strong>Advance science:</strong> Understand intelligence itself</li>
                        </ul>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 2rem;">
                    <button class="btn btn-primary" onclick="hideHelp()">
                        Got it! Let's explore 🚀
                    </button>
                </div>
            </div>

            <!-- Loading -->
            <div id="loading" class="loading" style="display: none;">
                <div class="spinner"></div>
                <h3 style="color: var(--primary); margin-bottom: 0.5rem;">Reading AI Mind...</h3>
                <p style="color: var(--gray-600);">Analyzing neural patterns and thought processes</p>
            </div>

            <!-- Results -->
            <div id="results" class="results-grid" style="display: none;">
                <!-- Token Activations Card -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">🎨</div>
                        <h3 class="card-title">Neural Activity Map</h3>
                    </div>
                    
                    <div class="info-box">
                        <strong>💡 What you're seeing:</strong> Each word is colored by how much the AI's neurons activate. 
                        Darker colors mean the AI is paying more attention to that word.
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <label style="font-weight: 600; color: var(--gray-700); margin-bottom: 0.5rem; display: block;">
                            Thinking Layer:
                        </label>
                        <select id="layerSelect" onchange="updateTokens()" style="
                            padding: 0.75rem;
                            border: 2px solid var(--gray-200);
                            border-radius: var(--border-radius);
                            font-size: 0.875rem;
                            background: white;
                            min-width: 150px;
                        "></select>
                        <button class="btn btn-secondary" onclick="showTokenComparison()" style="margin-left: 1rem;">
                            🔍 Deep Analysis
                        </button>
                        <button class="btn btn-secondary" onclick="findTopTokens()">
                            🔥 Find Patterns
                        </button>
                    </div>
                    
                    <div id="tokens" class="tokens-container"></div>
                    
                    <div style="margin-top: 1rem; padding: 1rem; background: var(--gray-50); border-radius: var(--border-radius); font-size: 0.875rem; color: var(--gray-600);">
                        <strong>💡 Try this:</strong> Switch between layers to see how the AI's focus changes as it "thinks deeper" about your text.
                    </div>
                    
                    <div id="tokenComparison" style="display: none;"></div>
                </div>

                <!-- Top Neurons Card -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">⚡</div>
                        <h3 class="card-title">Most Active Neurons</h3>
                    </div>
                    
                    <div class="info-box">
                        <strong>💡 What you're seeing:</strong> The AI has millions of "neurons" (like brain cells). 
                        These are the ones firing most strongly for your text.
                    </div>
                    
                    <div id="neurons" class="neuron-list"></div>
                    
                    <div style="margin-top: 1rem; padding: 1rem; background: var(--gray-50); border-radius: var(--border-radius); font-size: 0.875rem; color: var(--gray-600);">
                        <strong>🧠 Fun fact:</strong> Different neurons specialize in different concepts - some detect emotions, others understand grammar!
                    </div>
                </div>

                <!-- Attention Patterns Card -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">👁️</div>
                        <h3 class="card-title">Attention Network</h3>
                    </div>
                    
                    <div class="info-box">
                        <strong>💡 What you're seeing:</strong> This shows how the AI "pays attention" - which words it looks at when processing each word.
                    </div>
                    
                    <div id="attention" class="attention-container"></div>
                    
                    <div style="margin-top: 1rem; padding: 1rem; background: var(--gray-50); border-radius: var(--border-radius); font-size: 0.875rem; color: var(--gray-600);">
                        <strong>🔍 How to read:</strong> Darker squares show stronger connections. The word "cat" might look back at "the" to understand context.
                    </div>
                </div>

                <!-- Features Card -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">📊</div>
                        <h3 class="card-title">Language Patterns</h3>
                    </div>
                    
                    <div class="info-box">
                        <strong>💡 What you're seeing:</strong> The AI automatically categorizes words by type. 
                        This shows what linguistic patterns it discovered in your text.
                    </div>
                    
                    <div id="features" class="features-grid"></div>
                    
                    <div style="margin-top: 1rem; padding: 1rem; background: var(--gray-50); border-radius: var(--border-radius); font-size: 0.875rem; color: var(--gray-600);">
                        <strong>✨ Amazing insight:</strong> The AI learned these categories without being taught - it discovered grammar from reading!
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Status Indicator -->
    <div id="status" class="status demo">🤖 Demo Mode</div>

    <!-- Tooltip -->
    <div id="tooltip" class="tooltip"></div>

    <script>
        let currentData = null;
        
        function analyze() {
            const text = document.getElementById('textInput').value;
            if (!text) return;
            
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').style.display = 'none';
            
            // Try real API
            fetch('/api/analyze', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({text: text})
            })
            .then(r => r.json())
            .then(data => {
                if (data.success) {
                    updateStatus('🧠 Live AI Model', 'success');
                    loadRealData(data);
                } else {
                    throw new Error(data.error);
                }
            })
            .catch(() => {
                updateStatus('🎨 Demo Mode', 'demo');
                loadDemoData(text);
            })
            .finally(() => {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('results').style.display = 'grid';
            });
        }

        function updateStatus(text, type) {
            const statusEl = document.getElementById('status');
            statusEl.textContent = text;
            statusEl.className = `status ${type}`;
        }

        function loadRealData(data) {
            currentData = {
                tokens: data.tokens,
                activations: data.activations,
                attention: data.attention,
                topNeurons: data.top_neurons
            };
            populateLayerSelect();
            updateDisplay();
        }

        function loadDemoData(text) {
            const tokens = text.split(/\s+/);
            const layers = 6;
            
            // Generate demo activations
            const activations = {};
            for (let l = 0; l < layers; l++) {
                activations[l] = tokens.map(() => 
                    Array.from({length: 20}, () => Math.random())
                );
            }
            
            // Generate demo attention
            const attention = {};
            attention[0] = {};
            attention[0][0] = tokens.map((_, i) => 
                tokens.map((_, j) => {
                    let val = Math.random() * 0.3;
                    if (i === j) val += 0.3;
                    if (j < i) val += 0.2;
                    return Math.min(val, 1);
                })
            );
            
            // Generate demo neurons
            const topNeurons = {};
            for (let l = 0; l < layers; l++) {
                topNeurons[l] = Array.from({length: 10}, (_, i) => ({
                    neuron_id: i * 10 + l,
                    activation: Math.random(),
                    type: ['Entity', 'Syntax', 'Semantic', 'Position', 'Attention'][i % 5]
                })).sort((a, b) => b.activation - a.activation);
            }
            
            currentData = { tokens, activations, attention, topNeurons };
            populateLayerSelect();
            updateDisplay();
        }

        function populateLayerSelect() {
            const select = document.getElementById('layerSelect');
            select.innerHTML = '';
            Object.keys(currentData.activations).forEach(layer => {
                const option = document.createElement('option');
                option.value = layer;
                option.textContent = `Layer ${layer}`;
                select.appendChild(option);
            });
        }

        function updateDisplay() {
            updateTokens();
            updateNeurons();
            updateAttention();
            updateFeatures();
        }

        function updateTokens() {
            const layer = parseInt(document.getElementById('layerSelect').value);
            const container = document.getElementById('tokens');
            container.innerHTML = '';
            
            // Calculate activation stats for this layer
            let layerStats = {
                min: Infinity,
                max: -Infinity,
                activations: []
            };
            
            // First pass: calculate statistics
            currentData.tokens.forEach((token, i) => {
                if (currentData.activations[layer] && currentData.activations[layer][i]) {
                    const activations = currentData.activations[layer][i];
                    const avg = activations.reduce((a, b) => a + b, 0) / activations.length;
                    layerStats.activations.push(avg);
                    layerStats.min = Math.min(layerStats.min, avg);
                    layerStats.max = Math.max(layerStats.max, avg);
                } else {
                    layerStats.activations.push(0);
                }
            });
            
            layerStats.range = layerStats.max - layerStats.min;
            
            // Second pass: render tokens with modern styling
            currentData.tokens.forEach((token, i) => {
                const div = document.createElement('div');
                div.className = 'token';
                div.textContent = token;
                
                const activation = layerStats.activations[i];
                
                if (activation > 0 && layerStats.range > 0) {
                    const normalizedActivation = (activation - layerStats.min) / layerStats.range;
                    const intensity = Math.pow(normalizedActivation, 0.7);
                    
                    // Modern gradient coloring
                    let background, color, borderColor;
                    
                    if (intensity < 0.3) {
                        // Low activation - subtle blue
                        background = `linear-gradient(135deg, #eff6ff ${100-intensity*100}%, #dbeafe 100%)`;
                        color = '#1e40af';
                        borderColor = '#bfdbfe';
                    } else if (intensity < 0.7) {
                        // Medium activation - warm orange
                        background = `linear-gradient(135deg, #fffbeb ${100-intensity*100}%, #fef3c7 100%)`;
                        color = '#92400e';
                        borderColor = '#fde68a';
                    } else {
                        // High activation - vibrant red
                        background = `linear-gradient(135deg, #fef2f2 ${100-intensity*100}%, #fecaca 100%)`;
                        color = '#991b1b';
                        borderColor = '#f87171';
                    }
                    
                    div.style.background = background;
                    div.style.color = color;
                    div.style.borderColor = borderColor;
                    
                    if (intensity > 0.8) {
                        div.style.transform = 'scale(1.05)';
                        div.style.boxShadow = '0 8px 25px rgba(239, 68, 68, 0.3)';
                        div.style.fontWeight = '600';
                    }
                    
                    div.title = `Word: "${token}"\nActivation: ${activation.toFixed(4)}\nIntensity: ${(intensity * 100).toFixed(1)}%`;
                }
                
                container.appendChild(div);
            });
        }

        function updateNeurons() {
            const layer = parseInt(document.getElementById('layerSelect').value);
            const container = document.getElementById('neurons');
            container.innerHTML = '';
            
            if (currentData.topNeurons[layer]) {
                currentData.topNeurons[layer].slice(0, 8).forEach(neuron => {
                    const div = document.createElement('div');
                    div.className = 'neuron-item';
                    
                    div.innerHTML = `
                        <div class="neuron-info">
                            <div class="neuron-id">Neuron ${neuron.neuron_id}</div>
                            <div class="neuron-type">${neuron.type}</div>
                        </div>
                        <div class="activation-value">${neuron.activation.toFixed(4)}</div>
                    `;
                    
                    container.appendChild(div);
                });
            }
        }

        function updateAttention() {
            const container = document.getElementById('attention');
            container.innerHTML = '';
            
            if (currentData.attention[0] && currentData.attention[0][0]) {
                const matrix = currentData.attention[0][0];
                const cellSize = 25;
                const margin = 60;
                
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svg.setAttribute('width', matrix.length * cellSize + margin * 2);
                svg.setAttribute('height', matrix.length * cellSize + margin * 2);
                svg.style.maxWidth = '100%';
                svg.style.height = 'auto';
                
                // Add cells
                matrix.forEach((row, i) => {
                    row.forEach((value, j) => {
                        const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                        rect.setAttribute('x', j * cellSize + margin);
                        rect.setAttribute('y', i * cellSize + margin);
                        rect.setAttribute('width', cellSize - 1);
                        rect.setAttribute('height', cellSize - 1);
                        
                        const intensity = value;
                        const hue = 220; // Blue hue
                        const saturation = 70 + intensity * 30;
                        const lightness = 95 - intensity * 40;
                        
                        rect.setAttribute('fill', `hsl(${hue}, ${saturation}%, ${lightness}%)`);
                        rect.setAttribute('class', 'attention-cell');
                        
                        rect.addEventListener('mouseenter', (e) => {
                            showTooltip(e, `From: "${currentData.tokens[i]}"<br>To: "${currentData.tokens[j]}"<br>Attention: ${value.toFixed(3)}`);
                        });
                        
                        rect.addEventListener('mouseleave', hideTooltip);
                        
                        svg.appendChild(rect);
                    });
                });
                
                // Add labels
                currentData.tokens.forEach((token, i) => {
                    // Row labels
                    const rowLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    rowLabel.setAttribute('x', margin - 5);
                    rowLabel.setAttribute('y', i * cellSize + margin + cellSize/2);
                    rowLabel.setAttribute('text-anchor', 'end');
                    rowLabel.setAttribute('dominant-baseline', 'middle');
                    rowLabel.style.fontSize = '10px';
                    rowLabel.style.fill = '#6b7280';
                    rowLabel.textContent = token.length > 8 ? token.substring(0, 8) + '...' : token;
                    svg.appendChild(rowLabel);
                    
                    // Column labels
                    const colLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    colLabel.setAttribute('x', i * cellSize + margin + cellSize/2);
                    colLabel.setAttribute('y', margin - 5);
                    colLabel.setAttribute('text-anchor', 'middle');
                    colLabel.setAttribute('dominant-baseline', 'end');
                    colLabel.style.fontSize = '10px';
                    colLabel.style.fill = '#6b7280';
                    colLabel.textContent = token.length > 8 ? token.substring(0, 8) + '...' : token;
                    svg.appendChild(colLabel);
                });
                
                container.appendChild(svg);
            }
        }

        function updateFeatures() {
            const container = document.getElementById('features');
            const text = currentData.tokens.join(' ').toLowerCase();
            
            const features = {
                'Animals': (text.match(/cat|dog|bird|mouse|lion|tiger|elephant/g) || []).length,
                'Objects': (text.match(/mat|chair|table|house|car|book|tree|garden/g) || []).length,
                'Actions': (text.match(/sat|run|jump|play|walk|explore|climb/g) || []).length,
                'Emotions': (text.match(/happy|sad|love|amazing|curious|mysterious/g) || []).length,
                'Articles': (text.match(/the|a|an/g) || []).length,
                'Descriptions': (text.match(/big|small|red|blue|beautiful|curious|mysterious/g) || []).length
            };
            
            container.innerHTML = Object.entries(features)
                .map(([name, count]) => `
                    <div class="feature-item">
                        <div class="feature-count">${count}</div>
                        <div class="feature-label">${name}</div>
                    </div>
                `).join('');
        }

        function showTokenComparison() {
            if (!currentData) {
                alert('Please run analysis first!');
                return;
            }
            
            const comparisonDiv = document.getElementById('tokenComparison');
            comparisonDiv.style.display = 'block';
            comparisonDiv.innerHTML = `
                <div class="comparison-section">
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <h4 style="color: var(--primary); font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem;">
                            🔬 Deep Neural Analysis
                        </h4>
                        <p style="color: var(--gray-600);">
                            Explore how the AI processes specific words across all thinking layers
                        </p>
                    </div>
                    
                    <div class="analysis-controls">
                        <input type="text" id="tokenSearch" class="search-input" 
                               placeholder="Enter word to analyze (e.g., 'cat', 'the', 'ing')">
                        <button class="btn btn-primary" onclick="analyzeSpecificToken()">
                            🔍 Analyze Word
                        </button>
                        <button class="btn btn-secondary" onclick="analyzeAllTokens()">
                            📊 Analyze All
                        </button>
                    </div>
                    
                    <div id="tokenAnalysisResults"></div>
                </div>
            `;
        }

        function analyzeSpecificToken() {
            const searchTerm = document.getElementById('tokenSearch').value.toLowerCase().trim();
            if (!searchTerm) {
                alert('Please enter a word to search for.');
                return;
            }
            
            const resultsDiv = document.getElementById('tokenAnalysisResults');
            
            // Find matching tokens
            const matchingTokens = [];
            currentData.tokens.forEach((token, i) => {
                if (token.toLowerCase().includes(searchTerm)) {
                    matchingTokens.push({index: i, token: token});
                }
            });
            
            if (matchingTokens.length === 0) {
                resultsDiv.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: var(--gray-500);">
                        No words containing "${searchTerm}" found. Try a different search term.
                    </div>
                `;
                return;
            }
            
            resultsDiv.innerHTML = '';
            
            matchingTokens.forEach(({index, token}) => {
                const layerActivations = [];
                Object.keys(currentData.activations).forEach(layer => {
                    if (currentData.activations[layer] && currentData.activations[layer][index]) {
                        const activations = currentData.activations[layer][index];
                        const avg = activations.reduce((a, b) => a + b, 0) / activations.length;
                        layerActivations.push({layer: parseInt(layer), activation: avg});
                    }
                });
                
                layerActivations.sort((a, b) => a.layer - b.layer);
                const maxActivation = Math.max(...layerActivations.map(l => l.activation));
                
                const resultDiv = document.createElement('div');
                resultDiv.className = 'analysis-result';
                
                resultDiv.innerHTML = `
                    <div class="result-header">
                        <h5 style="color: var(--primary); font-weight: 600; margin-bottom: 0.5rem;">
                            📍 Word: "${token}" (position ${index + 1})
                        </h5>
                        <p style="color: var(--gray-600); font-size: 0.875rem; margin: 0;">
                            Neural activation across all AI thinking layers
                        </p>
                    </div>
                    <div class="result-content">
                        ${layerActivations.map(({layer, activation}) => {
                            const intensity = maxActivation > 0 ? activation / maxActivation : 0;
                            const width = Math.max(intensity * 100, 2);
                            const isPeak = intensity > 0.8;
                            
                            return `
                                <div class="activation-bar">
                                    <div class="bar-label">Layer ${layer}:</div>
                                    <div class="bar-visual" style="width: 250px;">
                                        <div class="bar-fill" style="
                                            width: ${width}%;
                                            background: ${isPeak ? 
                                                'linear-gradient(90deg, #ef4444, #dc2626)' : 
                                                'linear-gradient(90deg, #3b82f6, #1d4ed8)'
                                            };
                                            ${isPeak ? 'box-shadow: 0 0 10px rgba(239, 68, 68, 0.3);' : ''}
                                        "></div>
                                    </div>
                                    <div class="bar-value">
                                        ${activation.toFixed(4)} ${isPeak ? '🔥' : ''}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                        
                        <div style="margin-top: 1.5rem; padding: 1rem; background: var(--gray-50); border-radius: var(--border-radius); font-size: 0.875rem;">
                            <strong style="color: var(--primary);">🧠 AI Insight:</strong>
                            <span style="color: var(--gray-600);">
                                Peak layers (🔥) show where the AI focuses most when processing "${token}". 
                                This reveals specialized neural circuits for different aspects of language understanding.
                            </span>
                        </div>
                    </div>
                `;
                
                resultsDiv.appendChild(resultDiv);
            });
        }

        function findTopTokens() {
            if (!currentData) {
                alert('Please run analysis first!');
                return;
            }
            
            const comparisonDiv = document.getElementById('tokenComparison');
            comparisonDiv.style.display = 'block';
            comparisonDiv.innerHTML = `
                <div class="comparison-section">
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <h4 style="color: var(--primary); font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem;">
                            🔥 Neural Pattern Discovery
                        </h4>
                        <p style="color: var(--gray-600);">
                            Revealing which words activate most in each AI thinking layer
                        </p>
                    </div>
                    
                    <div id="patternResults"></div>
                </div>
            `;
            
            const resultsDiv = document.getElementById('patternResults');
            
            Object.keys(currentData.activations).sort((a, b) => parseInt(a) - parseInt(b)).forEach(layer => {
                const layerActivations = [];
                currentData.tokens.forEach((token, index) => {
                    if (currentData.activations[layer] && currentData.activations[layer][index]) {
                        const activations = currentData.activations[layer][index];
                        const avg = activations.reduce((a, b) => a + b, 0) / activations.length;
                        layerActivations.push({token, index, activation: avg});
                    }
                });
                
                layerActivations.sort((a, b) => b.activation - a.activation);
                const topTokens = layerActivations.slice(0, 3);
                
                const layerDiv = document.createElement('div');
                layerDiv.className = 'analysis-result';
                
                const layerDescription = getLayerDescription(parseInt(layer));
                
                layerDiv.innerHTML = `
                    <div class="result-header">
                        <h5 style="color: var(--primary); font-weight: 600; margin-bottom: 0.5rem;">
                            Layer ${layer} - ${layerDescription}
                        </h5>
                    </div>
                    <div class="result-content">
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                            ${topTokens.map((item, i) => {
                                const colors = ['#ef4444', '#f59e0b', '#10b981'];
                                const medals = ['🥇', '🥈', '🥉'];
                                return `
                                    <div style="
                                        background: linear-gradient(135deg, ${colors[i]}15, white);
                                        border: 2px solid ${colors[i]}30;
                                        border-radius: var(--border-radius);
                                        padding: 1rem;
                                        text-align: center;
                                        min-width: 120px;
                                    ">
                                        <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">${medals[i]}</div>
                                        <div style="font-weight: 600; color: var(--gray-900); margin-bottom: 0.25rem;">
                                            "${item.token}"
                                        </div>
                                        <div style="font-family: monospace; font-size: 0.875rem; color: ${colors[i]}; font-weight: 600;">
                                            ${item.activation.toFixed(4)}
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
                
                resultsDiv.appendChild(layerDiv);
            });
        }

        function getLayerDescription(layer) {
            const descriptions = {
                0: "Letter & Sound Recognition",
                1: "Word Part Assembly", 
                2: "Grammar & Word Types",
                3: "Sentence Structure",
                4: "Meaning & Context",
                5: "High-Level Reasoning"
            };
            return descriptions[layer] || "Advanced Processing";
        }

        function loadExample(type) {
            const examples = {
                sentiment: "I absolutely love this amazing and wonderful experience!",
                grammar: "The curious cats are playfully exploring the mysterious garden."
            };
            document.getElementById('textInput').value = examples[type];
        }

        function showHelp() {
            document.getElementById('helpSection').style.display = 'block';
        }

        function hideHelp() {
            document.getElementById('helpSection').style.display = 'none';
        }

        function showTooltip(event, content) {
            const tooltip = document.getElementById('tooltip');
            tooltip.innerHTML = content;
            tooltip.style.opacity = '1';
            tooltip.style.left = (event.pageX + 10) + 'px';
            tooltip.style.top = (event.pageY - 10) + 'px';
        }

        function hideTooltip() {
            document.getElementById('tooltip').style.opacity = '0';
        }

        // Auto-analyze on load
        window.onload = () => analyze();
    </script>
</body>
</html>